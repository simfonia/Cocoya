# Cocoya 工作日誌 (2026-02-14)

## 本日進度
- **UI 工具列實作**：
    - 在 Webview 頂部加入工具列，包含：開新專案、開啟專案、儲存、另存、更新、關閉。
    - 使用指定 icons (new, load_project, save, save_as, published_with_changes, dangerous) 並實作 hover 切換效果。
- **檔案操作與通訊**：
    - 連結 Webview 與 Extension Host，實作 XML 專案檔的讀取與寫入。
    - 使用 VS Code 原生 `showOpenDialog` 與 `showSaveDialog` 確保使用者體驗一致。
- **髒狀態 (Dirty State) 追蹤**：
    - 監聽 Blockly 變動事件，當工作區修改時，「儲存」按鈕會出現粉紅底線標記。
    - 儲存後或載入檔案後自動清除髒狀態。
- **動作回饋**：
    - 模仿 piBlockly 實作按鈕點擊後的閃爍效果 (Flash effect)。
    - 「更新」動作會觸發 Extension 跳出提示訊息，並回傳成功狀態以清除閃爍。

## 變更檔案
- `media/index.html`: 加入工具列 HTML/CSS。
- `media/ui_manager.js`: 實作 `initToolbar`, `setDirty`, `flashButton`。
- `media/main.js`: 綁定事件監聽與 Host 訊息處理。
- `src/extension.ts`: 實作檔案操作 Command Handler。
- `media/zh-hant.js`: 更新語系與顏色定義。

## 核心架構重構 (Refactoring)
- **Extension Host (TS)**: 引入 CocoyaManager 類別，將通訊、檔案操作、執行管理與更新檢查模組化，解決程式碼過於臃腫的問題。
- **Webview Logic (JS)**: 引入 CocoyaApp 物件，實作結構化的生命週期管理，並強化異步載入的穩定性。
- **UI Manager (JS)**: 引入 CocoyaUI 物件，統一採用 camelCase 命名，補全 JSDoc 註解，並優化 DOM 操作效能。
- **i18n 全面化**: 實作語系同步機制，讓 VS Code 原生對話框也能支援多國語系顯示。

## 安全性與執行優化
- **指令安全**: 在執行 Python 程式前自動過濾定位標記 (\u0001ID:...), 確保產出純淨代碼。
- **路徑驗證**: 實作 Python 執行路徑的自動偵測與失效提示機制。
- **執行穩定性**: 優化 PowerShell 指令呼叫，解決路徑空格與自動中斷導致的終端機崩潰問題。

## 文件與規範
- **系統規格書**: 產出 docs/system_spec.html 電子書，定義變數命名、通訊協議與架構設計規範。
- **基礎文件**: 補全 LICENSE.md (MIT) 與 README.md。
- **打包流程**: 完成 sce 打包配置，可產出正式 VSIX 檔案。
