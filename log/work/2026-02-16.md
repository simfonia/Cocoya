# Cocoya 工作日誌 - 2026-02-16
## 2026-02-16 工作紀錄
### 1. 核心架構重構 (Modular & Flattened)
- **目錄統整**：將 core_modules 併入 media/modules/core，達成所有功能塊的統一管理。
- **平行載入優化**：module_loader.js 改用 Promise.all 平行載入所有模組，顯著提升啟動與模式切換速度，同時保持載入順序。
- **語系分散化 (Modular i18n)**：實作分散式語系管理，各模組擁有獨立的 i18n/ 目錄，核心語系檔精簡至僅保留全域 UI 文字。

### 2. AI 視覺模組開發 (OpenCV Basic & Drawing)
- **子模組細切**：將 AI 視覺拆分為 cv_basic, cv_draw, i_hand 三大區塊。
- **cv_basic**：完成鏡頭初始化、畫面擷取、影像翻轉、視窗顯示與鍵盤中斷 (waitKey) 等基礎積木。
- **cv_draw**：完成矩形、圓形、直線、文字繪製積木，並內建 Tuple 影子積木以優化座標與顏色輸入。

### 3. 精確定位與「唯一真理」同步機制
- **1:1 行號對齊**：確立「Preview 即執行檔」原則，兩者共用同一份預處理字串，徹底解決行號位移與除錯困擾。
- **行尾 ID 註解**：改用 # ID:xxx 行尾註解進行定位，修復了容器積木（如 Global Def）定位失效的問題，同時不破壞 Python 縮排。
- **自動隱藏標記**：UI 渲染器能在保持行號的前提下，動態從預覽畫面上抹除所有 ID 標記。

### 4. UI/UX 與效能微調
- **縮排輔助功能**：新增「縮排對齊線」視覺指引，並提供 2/4 Spaces 動態切換功能（連動產生器與預覽）。
- **複製功能**：新增「複製程式碼」按鈕，具備品牌色 Hover 效果，並在複製時自動清理所有 ID 註解。
- **效能優化**：將孤兒積木檢查演算法優化為 (N)$ Top-Down 模式，並微調防抖時間 (150ms/300ms)，解決垃圾桶動畫延遲問題。
- **路徑顯示**：優化 VS Code 標題列格式與狀態列路徑提示。


### 5. 積木定義標準化重構 (Standardization)
- **全面 JSON 化**：將專案中大多數積木定義從「程序化編寫」重構為 Blockly 推薦的 jsonInit + rgs0 模式。
- **i18n 安全性提升**：透過 message0 與 rgs0 自動處理語系佔位符 (%1, %2)，徹底解決手動 split 導致的文字殘留或排版偏移問題。
- **涵蓋模組**：
    - core/logic：比較、邏輯運算、布林值積木重構。
    - core/math：數值、算術、三角函數、四捨五入、亂數積木重構。
    - core/text：字串、多行文字、長度積木重構。
    - core/tools：Print、Input、註解、原始碼積木重構。
    - hardware：板載 LED 控制積木重構。
    - cv_basic & cv_draw：所有 AI 視覺積木重構。

### 6. 影像標註模組 (cv_draw) 進階優化
- **極簡座標與顏色積木**：
    - 實作 py_ai_point 與 py_ai_color 取代原本龐大的變形 Tuple 積木。
    - 使用 ield_number 內嵌數字輸入，大幅縮小積木體積並優化佈局。
    - 新增 i18n Tooltip 說明 (X, Y) 與 (B, G, R) 的順序規範。
- **佈局美化**：啟用 inputsInline 讓繪圖積木橫向展開，節省垂直空間。

