# 工作日誌 2026-02-24

## 平台相容性優化 (PC & CircuitPython)
- **[產生器]** 實作 `Blockly.Python.PLATFORM` 注入機制，使產生器能根據目前模式切換代碼風格。
- **[結構]** 優化 `py_main` 入口積木，在 MCU 模式下自動移除 `if __name__ == "__main__":` 封裝，改為直接執行。
- **[通訊]** 重構 Serial (IO) 模組產生器，在 PC 模式維持使用 `pyserial`，在 MCU 模式自動切換為 `usb_cdc` (data channel)，並具備連線狀態檢查。
- **[硬體]** 優化 `mcu_set_led` 積木，在 MCU 模式下自動注入 `digitalio` 與 `board` 初始化代碼，並具備全域物件檢查機制防止重複宣告。

## 核心架構
- **[UI]** 確保切換平台模式時，Blockly 產生器環境變數同步更新。
- **[規範]** 完成全域與模組產生器的平台適配檢查。


## AI 運動分析與系統穩定性 (Milestone v2.5 完成)
- **[新增]** 實作上半身互動積木：calc_dist (距離計算)、get_velocity (速度計算)、detect_punch (出拳判定)。
- **[新增]** 實作 is_in_frame (座標有效性檢查) 積木，提升 AI 數據採集的嚴謹度。
- **[優化]** 重構 Blockly.Python.scrub_ 產生器遍歷邏輯，建立「運算式與陳述句」的隔離防護，徹底解決 Next statement does not exist 崩潰錯誤。
- **[修復]** 解決 Coding 模組更名後導致的舊範例載入失敗問題（全域修補 py_tools -> py_coding）。
- **[範例]** 建立 16_AirBoxer.xml (空氣拳擊力道計)，包含變數初始化、邊界防爆、自動歸零機制與紅色警告 UI。
- **[規範]** 修正靈敏度產生器邏輯，將判定門檻與積木數值動態鏈接。


## 效能優化與環境診斷助手 (Milestone v2.6 完成)
- **[優化]** 實作 OpenCV 圖片快取機制 (cocoya_img_cache)：避免在 AI 迴圈中重複讀取磁碟，顯著提升 Overlay Image 的 FPS 流暢度。
- **[功能]** 新增「環境診斷助手」：可自動偵測 opencv, mediapipe, Pillow, pyserial 等必要套件的安裝狀態。
- **[功能]** 實作「一鍵安裝」：針對缺失套件提供安裝按鈕，自動透過 pip 進行背景安裝並動態重新整理狀態。
- **[UI/UX]** 工具列新增診斷按鈕（使用 dashboard_customize 圖示），並全面支援 I18N 語系切換。
- **[規範]** 完成 media/index.html 與 media/ui_manager.js 的 I18N 重構，移除硬編碼文字。
