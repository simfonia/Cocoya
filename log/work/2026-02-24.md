# 工作日誌 2026-02-24

## 平台相容性優化 (PC & CircuitPython)
- **[產生器]** 實作 `Blockly.Python.PLATFORM` 注入機制，使產生器能根據目前模式切換代碼風格。
- **[結構]** 優化 `py_main` 入口積木，在 MCU 模式下自動移除 `if __name__ == "__main__":` 封裝，改為直接執行。
- **[通訊]** 重構 Serial (IO) 模組產生器，在 PC 模式維持使用 `pyserial`，在 MCU 模式自動切換為 `usb_cdc` (data channel)，並具備連線狀態檢查。
- **[硬體]** 優化 `mcu_set_led` 積木，在 MCU 模式下自動注入 `digitalio` 與 `board` 初始化代碼，並具備全域物件檢查機制防止重複宣告。

## 核心架構
- **[UI]** 確保切換平台模式時，Blockly 產生器環境變數同步更新。
- **[規範]** 完成全域與模組產生器的平台適配檢查。


## AI 運動分析與系統穩定性 (Milestone v2.5 完成)
- **[新增]** 實作上半身互動積木：calc_dist (距離計算)、get_velocity (速度計算)、detect_punch (出拳判定)。
- **[新增]** 實作 is_in_frame (座標有效性檢查) 積木，提升 AI 數據採集的嚴謹度。
- **[優化]** 重構 Blockly.Python.scrub_ 產生器遍歷邏輯，建立「運算式與陳述句」的隔離防護，徹底解決 Next statement does not exist 崩潰錯誤。
- **[修復]** 解決 Coding 模組更名後導致的舊範例載入失敗問題（全域修補 py_tools -> py_coding）。
- **[範例]** 建立 16_AirBoxer.xml (空氣拳擊力道計)，包含變數初始化、邊界防爆、自動歸零機制與紅色警告 UI。
- **[規範]** 修正靈敏度產生器邏輯，將判定門檻與積木數值動態鏈接。
