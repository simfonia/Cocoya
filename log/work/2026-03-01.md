
## [2026-03-01] πCar 模組功能微調與硬體邏輯校正
### 異動重點：
- **馬達控制 (Motor Control)**：
    - 全面將「速度」文字更換為符合物理特性的「功率 %」。
    - 強化停止積木：新增「煞車 (Brake)」與「滑行 (Coast)」選單。
    - **硬體邏輯修正**：經電路圖與實測驗證，Maker Pi RP2040 (MX1508) 之真實邏輯為 Low (0)=Brake, High (65535)=Coast。
    - 產生器優化：在產出代碼中顯式加入 	ime.sleep 並附帶 i18n 註解（煞車 0.1s、滑行 0.01s）。
- **Servo 系統大幅強化**：
    - 術語統一：將「舵機」全面更換為「servo」。
    - **獨立校準機制**：<設定 servo 脈衝範圍> 現在支援選擇特定腳位，並改用 ield_number 實作 UI 數值回彈 (限制 400-2600us)。
    - **並行同步移動**：重構 PiCarServo 類別，實作 move_sync 靜態方法。現在「雙手旋出」為同步動作而非依序動作。
    - **速度曲線優化**：速度 10 為瞬間到位，1-9 映射為 0.1s 至 0.01s 的平滑步進。
    - **動態範圍映射**：旋出比例現在會根據使用者設定的 hand_range 動態計算角度。
- **感測器與 LED 優化**：
    - **超音波**：修正產生器未傳參之 Bug，並支援多組感測器動態執行實體（ultrasonic_TRIG_ECHO）。
    - **LED**：將設定積木改為「數值輸入」型式，支援變數與迴圈控制；產生器改用 _LED_MAP 字典動態管理腳位物件。
    - **按鈕**：更新等待積木文字，產出代碼加入換行縮排與「防彈跳/讓手離開」之技術註解。
- **UI 與 系統穩定性**：
    - 修復積木渲染時下拉選單顯示 Key 的問題（加入 Fallback 機制）。
    - 修復 PiCarServo 類別在特定順序下未定義的 NameError。
    - 重新排列 Toolbox 順序，將校準與角度設定積木移至最前。


## [2026-03-01 後續] Blockly UI/UX 深度升級
### 異動重點：
- **插件整合 (Plugins)**：
    - **Workspace Minimap (地圖)**：
        - 整合小地圖功能，實作「收合/展開」切換按鈕。
        - 針對 Webview 特性實作「原型鏈攔截 (Prototype Patching)」與「全局 SVG 屬性過濾」，徹底根除 	ranslate(NaN,NaN) 與 Expected length, NaN 報錯。
        - 優化載入邏輯，確保開新檔、載入舊檔與啟動時自動執行 zoomToFit。
    - **Scroll Options (拖拽捲動)**：
        - 成功註冊 ScrollBlockDragger 與 ScrollMetricsManager，優化大範圍編輯時的捲動體驗。
- **自研搜尋引擎 (Custom Block Search)**：
    - 捨棄外部搜尋插件，改為在 media/utils.js 中實作 BlockSearcher 模組。
    - **全文字深度索引**：支援搜尋積木表面的語系標籤、下拉選單內容及內部 ID（如 init 縮寫）。
    - **CJK 最佳化**：將搜尋門檻降至 1 個字元，徹底解決中文搜尋（如「馬達」、「燈」）反應遲鈍的問題。
    - **嵌入式 UI**：將搜尋框動態注入到 Toolbox 頂部，不佔用工具列空間，維持視覺一致性。
- **系統穩定性強化**：
    - **事件安全攔截**：修復了因地圖鏡像工作區引發的 isDragging 與 getSvgRoot 報錯。
    - **層級管理 (Z-Index)**：精確配置 Flyout(150) > Search(145) > Toolbox(140) 的層級，解決搜尋結果被擋住的問題。
    - **索引建立保護**：建立搜尋索引時自動禁用事件，解決 Can't delete non-existent block 的同步崩潰問題。

