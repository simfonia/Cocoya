# Cocoya 工作日誌 - 2026-02-19

## 程式碼同步增強與 UI 優化 (里程碑 v2.3+)

### 1. 核心功能：範圍高亮 (Range Highlighting)
*   **技術變革**：捨棄單行定位，改採 `S_ID` (Start) 與 `E_ID` (End) 雙標籤機制。
*   **產生器增強**：重寫 `Blockly.Python.scrub_`，確保陳述句積木的首末行皆帶有定位註解。
*   **渲染器優化**：`CocoyaUI` 現在會計算積木產出的行號區間，點擊積木時可高亮整段代碼（如整個 `if-else` 或 `while` 區塊）。
*   **解析器更新**：`CocoyaUtils.extractIds` 支援解析開始與結束標記。

### 2. UI/UX 優化：高亮顏色選取器
*   **功能**：在程式碼預覽視窗加入顏色選取按鈕。
*   **技術細節**：
    *   使用 CSS 變數 `--highlight-bg` 動態控制背景色。
    *   實作自動邊框演算法，根據背景色自動生成稍深的邊框色。
    *   整合 `localStorage`，確保使用者的顏色偏好在重新整理或重啟後能持續生效。

### 3. 文件與跨專案規劃
*   **系統規格書**：更新 `docs/system_spec.html` 至 v2.3，納入最新的 ID 定位規範。
*   **piBlockly 對齊計畫**：完成 piBlockly 隱形定位技術評估，將「零寬字元標記 (Zero-width markers)」技術納入 todo 清單，目標是讓 Arduino 代碼在保持乾淨的同時也能實現整段高亮。

### 4. 其他修正
*   更新 `media/utils.js`, `media/main.js`, `media/ui_manager.js` 之相關連動邏輯。
