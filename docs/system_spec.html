<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocoya 系統規格說明書</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #FE2F89;
            --sidebar-width: 280px;
            --bg-light: #f8f9fa;
            --text-main: #333;
        }

        body {
            font-family: "Segoe UI", "PingFang TC", "Microsoft JhengHei", sans-serif;
            margin: 0;
            display: flex;
            background-color: var(--bg-light);
            color: var(--text-main);
            line-height: 1.6;
        }

        /* 側邊導覽 */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--primary-color);
            color: white;
            position: fixed;
            overflow-y: auto;
            padding: 20px 0;
        }

        #sidebar h2 {
            padding: 0 25px;
            font-size: 1.2rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #sidebar ul {
            list-style: none;
            padding: 0;
        }

        #sidebar li a {
            display: block;
            padding: 12px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: 0.3s;
            font-size: 0.95rem;
        }

        #sidebar li a:hover {
            background: var(--secondary-color);
            padding-left: 35px;
        }

        /* 主要內容區 */
        #content {
            margin-left: var(--sidebar-width);
            padding: 40px 60px;
            max-width: 1000px;
        }

        section {
            margin-bottom: 60px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        h1 { font-size: 2.5rem; color: var(--primary-color); border-bottom: 3px solid var(--accent-color); padding-bottom: 10px; }
        h2 { font-size: 1.8rem; color: var(--secondary-color); margin-top: 0; border-left: 5px solid var(--accent-color); padding-left: 15px; }
        h3 { color: var(--primary-color); margin-top: 25px; }

        code { font-family: 'Consolas', monospace; background: #eee; padding: 2px 5px; border-radius: 4px; color: #d63384; }
        pre code { background: none; color: inherit; padding: 0; }

        .file-tree { background: #2d3436; color: #f1f2f6; padding: 20px; border-radius: 5px; font-family: monospace; }
        .spec-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .spec-table th, .spec-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .spec-table th { background-color: #f2f2f2; color: var(--primary-color); }

        .tag { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px; background: #e1e1e1; }
        .tag-ts { background: #3178c6; color: white; }
        .tag-js { background: #f7df1e; color: black; }
        .tag-py { background: #3776ab; color: white; }
        .tag-xml { background: #ff6600; color: white; }

        footer { text-align: center; margin-top: 40px; color: #888; font-size: 0.8rem; }
    </style>
</head>
<body>

<nav id="sidebar">
    <h2>Cocoya Spec</h2>
    <ul>
        <li><a href="#overview">1. 專案概述</a></li>
        <li><a href="#naming">2. 開發規範</a></li>
        <li><a href="#structure">3. 檔案架構</a></li>
        <li><a href="#platform">4. 平台模式與自動偵測</a></li>
        <li><a href="#deployment">5. 硬體部署系統 (MCU)</a></li>
        <li><a href="#webview">6. Webview 前端物件</a></li>
        <li><a href="#communication">7. 通訊協議</a></li>
        <li><a href="#i18n">8. 語系與轉義處理</a></li>
    </ul>
</nav>

<main id="content">
    <header>
        <h1>Cocoya 系統規格說明書 v1.1</h1>
        <p><strong>Code, Compute, Yield AI</strong> - 專為 AI 教育設計的視覺化開發環境。</p>
    </header>

    <section id="overview">
        <h2>1. 專案概述</h2>
        <p>Cocoya 是一個整合了 Blockly 與 Python (OpenCV/MediaPipe) 的 VS Code 擴充功能。它具備跨平台支援能力，可開發 PC 端 AI 程式或 CircuitPython 硬體程式。</p>
        <h3>核心技術</h3>
        <ul>
            <li><strong>Extension Host:</strong> TypeScript 4.9+ (VS Code API)</li>
            <li><strong>Frontend:</strong> Vanilla JavaScript (ES6), HTML5, CSS3</li>
            <li><strong>Logic Engine:</strong> Google Blockly v12.x</li>
            <li><strong>Hardware Bridge:</strong> Python Serial REPL / Disk Mount</li>
        </ul>
    </section>

    <section id="naming">
        <h2>2. 開發規範</h2>
        <table class="spec-table">
            <thead>
                <tr><th>類型</th><th>規範</th><th>範例</th></tr>
            </thead>
            <tbody>
                <tr><td>類別名稱</td><td><code>PascalCase</code></td><td><code>CocoyaManager</code></td></tr>
                <tr><td>變數與函式</td><td><code>camelCase</code></td><td><code>isDirty</code>, <code>handleRunCode()</code></td></tr>
                <tr><td>常數</td><td><code>UPPER_SNAKE_CASE</code></td><td><code>COLOUR_AI</code>, <code>TAG_START</code></td></tr>
                <tr><td>積木 ID</td><td><code>py_[module]_[name]</code></td><td><code>py_ai_open_camera</code></td></tr>
            </tbody>
        </table>
    </section>

    <section id="structure">
        <h2>3. 檔案架構</h2>
        <div class="file-tree">
            cocoya/<br>
            ├── src/ <span class="tag tag-ts">TS</span> (Host 端管理器)<br>
            ├── media/ (Webview 前端)<br>
            │   ├── core_modules/ <span class="tag tag-xml">XML</span> (積木分類模組)<br>
            │   ├── main.js <span class="tag tag-js">JS</span> (應用程式物件 CocoyaApp)<br>
            │   └── ui_manager.js <span class="tag tag-js">JS</span> (UI 管理器 CocoyaUI)<br>
            ├── resources/ <span class="tag tag-py">PY</span> (靜態資源)<br>
            │   └── deploy_mcu.py (硬體部署工具)<br>
            ├── temp_scripts/ (執行期暫存檔)<br>
            └── docs/ (系統規格書)
        </div>
    </section>

    <section id="platform">
        <h2>4. 平台模式與自動偵測</h2>
        <p>Cocoya 支援 <strong>PC (Python)</strong> 與 <strong>CircuitPython (MCU)</strong> 雙模式隔離。</p>
        <h3>XML 屬性標記</h3>
        <p>存檔時，系統會在 <code>&lt;xml&gt;</code> 標籤注入 <code>platform</code> 屬性：</p>
        <pre><code class="language-xml">&lt;xml platform="CircuitPython"&gt; ... &lt;/xml&gt;</code></pre>
        <h3>自動偵測機制</h3>
        <ul>
            <li><strong>優先順序 1：</strong> 讀取 XML 根節點的 <code>platform</code> 屬性。</li>
            <li><strong>優先順序 2 (備援)：</strong> 掃描積木內容。若包含 <code>py_loop_while</code> 則判定為 CircuitPython。</li>
        </ul>
    </section>

    <section id="deployment">
        <h2>5. 硬體部署系統 (MCU)</h2>
        <p>部署邏輯封裝於 <code>resources/deploy_mcu.py</code> 中，執行流程如下：</p>
        <ol>
            <li><strong>磁碟偵測：</strong> 優先搜尋標籤為 <code>CIRCUITPY</code> 的磁碟進行直接寫入。</li>
            <li><strong>REPL 備援：</strong> 若無磁碟，則透過 Serial 進入 Raw REPL 模式進行傳輸。</li>
            <li><strong>Serial Monitor：</strong> 部署完成後自動開啟監控迴圈，即時顯示裝置 <code>print()</code> 輸出。</li>
        </ol>
    </section>

    <section id="webview">
        <h2>6. Webview 前端物件</h2>
        <h3>CocoyaApp (media/main.js)</h3>
        <ul>
            <li><code>currentPlatform</code>: 追蹤目前模式 (PC/CircuitPython)。</li>
            <li><code>switchPlatform(mode)</code>: 執行模式鎖定切換，重載 Toolbox 並重置工作區。</li>
        </ul>
        <h3>CocoyaUI (media/ui_manager.js)</h3>
        <ul>
            <li><code>updateRunTooltip(platform)</code>: 根據模式動態切換執行按鈕的提示文字。</li>
            <li><code>updateSerialPorts(ports)</code>: 動態更新序列埠下拉選單。</li>
        </ul>
    </section>

    <section id="communication">
        <h2>7. 通訊協議</h2>
        <table class="spec-table">
            <tr><th>指令</th><th>酬載關鍵字</th><th>用途</th></tr>
            <tr><td><code>loadWorkspace</code></td><td><code>xml, filename, platform</code></td><td>載入檔案並同步切換模式 UI。</td></tr>
            <tr><td><code>runCode</code></td><td><code>code, platform, serialPort</code></td><td>請求執行或部署。</td></tr>
            <tr><td><code>setDirty</code></td><td><code>isDirty</code></td><td>通知 Host 更新頁籤標題標記 (*)。</td></tr>
        </table>
    </section>

    <section id="i18n">
        <h2>8. 語系與轉義處理</h2>
        <p>所有 UI 字串與 Tooltip 必須透過 <code>media/zh-hant.js</code> 定義。前端 <code>applyI18n()</code> 會處理 <code>span</code>, <code>title</code> 與 <code>option</code> 標籤。</p>
        <p><strong>注意：</strong> 產出程式碼時，請使用 <code>\\n</code> 字面量換行符號，避免 JavaScript 載入錯誤。</p>
    </section>

    <footer>
        <p>© 2026 simfonia - Cocoya 專案組。文件更新日期：2026-02-14</p>
    </footer>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>
