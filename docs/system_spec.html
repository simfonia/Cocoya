<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cocoya 系統規格說明書</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #34495e;
            --accent-color: #FE2F89;
            --sidebar-width: 280px;
            --bg-light: #f8f9fa;
            --text-main: #333;
        }

        body {
            font-family: "Segoe UI", "PingFang TC", "Microsoft JhengHei", sans-serif;
            margin: 0;
            display: flex;
            background-color: var(--bg-light);
            color: var(--text-main);
            line-height: 1.6;
        }

        /* 側邊導覽 */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--primary-color);
            color: white;
            position: fixed;
            overflow-y: auto;
            padding: 20px 0;
        }

        #sidebar h2 {
            padding: 0 25px;
            font-size: 1.2rem;
            color: var(--accent-color);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        #sidebar ul {
            list-style: none;
            padding: 0;
        }

        #sidebar li a {
            display: block;
            padding: 12px 25px;
            color: #ecf0f1;
            text-decoration: none;
            transition: 0.3s;
            font-size: 0.95rem;
        }

        #sidebar li a:hover {
            background: var(--secondary-color);
            padding-left: 35px;
        }

        /* 主要內容區 */
        #content {
            margin-left: var(--sidebar-width);
            padding: 40px 60px;
            max-width: 1000px;
        }

        section {
            margin-bottom: 60px;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        h1 { font-size: 2.5rem; color: var(--primary-color); border-bottom: 3px solid var(--accent-color); padding-bottom: 10px; }
        h2 { font-size: 1.8rem; color: var(--secondary-color); margin-top: 0; border-left: 5px solid var(--accent-color); padding-left: 15px; }
        h3 { color: var(--primary-color); margin-top: 25px; }

        code { font-family: 'Consolas', monospace; background: #eee; padding: 2px 5px; border-radius: 4px; color: #d63384; }
        pre code { background: none; color: inherit; padding: 0; }

        .file-tree { background: #2d3436; color: #f1f2f6; padding: 20px; border-radius: 5px; font-family: monospace; }
        .spec-table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .spec-table th, .spec-table td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        .spec-table th { background-color: #f2f2f2; color: var(--primary-color); }

        .tag { display: inline-block; padding: 3px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px; background: #e1e1e1; }
        .tag-ts { background: #3178c6; color: white; }
        .tag-js { background: #f7df1e; color: black; }
        .tag-py { background: #3776ab; color: white; }
        .tag-xml { background: #ff6600; color: white; }

        footer { text-align: center; margin-top: 40px; color: #888; font-size: 0.8rem; }
    </style>
</head>
<body>

<nav id="sidebar">
    <h2>Cocoya Spec</h2>
    <ul>
        <li><a href="#overview">1. 專案概述</a></li>
        <li><a href="#naming">2. 開發規範</a></li>
        <li><a href="#structure">3. 檔案架構 (v1.5 統整版)</a></li>
        <li><a href="#module-system">4. 模組化與平行載入</a></li>
        <li><a href="#i18n-dist">5. 語系分散化管理 (i18n)</a></li>
        <li><a href="#platform">6. 平台模式與自動偵測</a></li>
        <li><a href="#performance">7. 效能優化 (State Check)</a></li>
        <li><a href="#deployment">8. 硬體部署系統 (MCU)</a></li>
    </ul>
</nav>

<main id="content">
    <header>
        <h1>Cocoya 系統規格說明書 v1.5</h1>
        <p><strong>Code, Compute, Yield AI</strong> - 專為 AI 教育設計的視覺化開發環境。</p>
    </header>

    <section id="overview">
        <h2>1. 專案概述</h2>
        <p>Cocoya 是一個整合了 Blockly 與 Python (OpenCV/MediaPipe) 的 VS Code 擴充功能。它具備跨平台支援能力，可開發 PC 端 AI 程式或 CircuitPython 硬體程式。</p>
        <h3>核心技術</h3>
        <ul>
            <li><strong>Extension Host:</strong> TypeScript 4.9+ (VS Code API)</li>
            <li><strong>Frontend:</strong> Vanilla JavaScript (ES6)</li>
            <li><strong>Logic Engine:</strong> Google Blockly v12.x</li>
            <li><strong>Parallel Loading:</strong> Promise.all 模組載入機制</li>
        </ul>
    </section>

    <section id="naming">
        <h2>2. 開發規範</h2>
        <table class="spec-table">
            <thead>
                <tr><th>類型</th><th>規範</th><th>範例</th></tr>
            </thead>
            <tbody>
                <tr><td>類別名稱</td><td><code>PascalCase</code></td><td><code>CocoyaManager</code></td></tr>
                <tr><td>變數與函式</td><td><code>camelCase</code></td><td><code>isDirty</code>, <code>handleRunCode()</code></td></tr>
                <tr><td>轉義字元</td><td><code>JS String</code></td><td>磁碟 JS 呈現 <code>\n</code>，工具寫入時使用 <code>\\n</code></td></tr>
                <tr><td>模組 ID</td><td><code>path/pure_id</code></td><td><code>core/logic</code>, <code>cv_basic</code></td></tr>
            </tbody>
        </table>
    </section>

    <section id="structure">
        <h2>3. 檔案架構 (v1.5 統整版)</h2>
        <p>為了簡化路徑邏輯，所有積木模組統一放置於 <code>media/modules/</code> 目錄下。</p>
        <div class="file-tree">
            cocoya/media/modules/<br>
            ├── core/ (基礎核心模組)<br>
            │   ├── logic/ (blocks.js, generators.js, toolbox.xml, i18n/)<br>
            │   └── ...<br>
            ├── cv_basic/ (OpenCV 基礎操作)<br>
            ├── cv_draw/ (OpenCV 繪圖標註)<br>
            └── hardware/ (硬體控制模組)
        </div>
    </section>

    <section id="module-system">
        <h2>4. 模組化與平行載入</h2>
        <p>系統採用 <code>Promise.all</code> 平行載入所有模組。順序由 <code>core_manifest.json</code> 決定，確保 Toolbox 分類順序一致且載入效能最優化。</p>
        <h3>ID 命名慣例</h3>
        <p>檔案命名必須遵循 <code>[pure_id]_blocks.js</code> 與 <code>[pure_id]_generators.js</code>。載入器會自動根據 ID 分段 (split) 並提取最後一部分作為檔名。</p>
    </section>

    <section id="i18n-dist">
        <h2>5. 語系分散化管理 (i18n)</h2>
        <p>為了解決單一語系檔過大的問題，採用分散式儲存：</p>
        <ul>
            <li><strong>全域語系:</strong> 位於 <code>media/zh-hant.js</code>，定義 UI 按鈕、對話框與分類總稱。</li>
            <li><strong>模組語系:</strong> 位於 <code>modules/[moduleId]/i18n/[lang].js</code>，僅定義該模組特有的積木文字。</li>
        </ul>
        <p>載入器會在載入積木前，優先嘗試載入對應的模組語系檔。</p>
    </section>

    <section id="platform">
        <h2>6. 平台模式與自動偵測</h2>
        <p>Cocoya 支援 <strong>PC (Python)</strong> 與 <strong>CircuitPython (MCU)</strong> 雙模式隔離。</p>
        <p>模式資訊會自動注入 XML 屬性中，實現「開檔即鎖定模式」的功能。</p>
    </section>

    <section id="performance">
        <h2>7. 效能優化 (State Check)</h2>
        <p>積木啟用狀態 (孤兒檢查) 採用 <strong>Top-Down 遞迴演算法</strong>。運算量與頂層積木數成線性關係 ($O(N)$)，顯著改善大規模專案下的拖拽流暢度與垃圾桶動畫效能。</p>
    </section>

    <section id="deployment">
        <h2>8. 硬體部署系統 (MCU)</h2>
        <p>部署邏輯封裝於 <code>resources/deploy_mcu.py</code> 中，支援透過磁碟 (CIRCUITPY) 或 Serial REPL 進行傳輸，並整合即時 Monitor。</p>
    </section>

    <footer>
        <p>© 2026 simfonia - Cocoya 專案組。文件更新日期：2026-02-16 (v1.5)</p>
    </footer>
</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
</body>
</html>
